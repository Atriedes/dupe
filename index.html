<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatbox</title>
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="body">
    <div class="wrapper">
        <div class="chatbox">
            <div class="chat-topic fixed">
                <p class="topic">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Dignissimos culpa illum incidunt hic et tempore ea velit maxime.</p>
            </div>
            <div class="scrollable">
                <div class="chat chat-pre">
                    <span class="name"></span>
                    <pre class="content">██████████████████████████████████████████████████████████████████████████
██████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓██████████████████████████████████
█████████████████████▓▓▓▓▒▒▒▒▒░░░░░░▒▒▒▓▓▓████████████████████████████████
██████████████████▓▓▓▓▒▒▒░░░      ░░░░░░░▒▓▓▓█████████████████████████████
███████████████▓▓▓▓▒▒▒░░░               ░░░▒▒▓▓▓██████████████████████████
████████████▓▓▓▓▒▒▒░░░░                    ░░░▒▒▓▓████████████████████████
███████████▓▓▓▒▒▒▒░░░                        ░░░▒▒▓▓▓█████████████████████
██████████▓▒▒▒░░░░                              ░░▒▒▓▓▓███████████████████
█████████▓▒▒░░░░                                   ░▒▒▓▓██████████████████
████████▓▒▒▒░                                ▄██▄   ░▒▒▒▓█████████████████
███████▓▒▒░░         ▄▄▄▄                   ▐░░░░▄   ░░▒▓█████████████████
█████▓▓▒▒░░       ▄▄█░░░░█                   ██▓░░▌    ▒▓▓████████████████
█████▓▒▒░░       ▄▓▓░░░░░▒█▄                 ███░░▌    ░▒▓▓▓██████████████
████▓▓▒░░       ▐▓░░░▓▓▓░░▒▒▄                 ██░░▌     ░▒▓▓██████████████
████▓▒▒░        █░░░▓████░░░░▌                 ░░▌      ░▒▒▓▓█████████████
██▓▓▒▒░        ▐░░░░██▄██░░░▓▌                 ▀▀        ░▒▒▓█████████████
██▓▒▒░░         █░░░░███░░▒▒▀                            ░░▒▒▓████████████
██▓▒▒░          ▐▒░░░░░░░░█▀             ██               ░░▒▓▓███████████
█▓▓▒░░           ▀▀█░░░█▀▀               ███               ░▒▒▓███████████
█▓▒░░               ▀▀▀                 ░█▓█               ░▒▒▓▓██████████
█▓▒░░                                   ▓█▓█▌               ░▒▒▓██████████
█▓▒░                                   ░██▓██               ░▒▒▓██████████
█▓▒░                                  ░█▓▓▓▓█    ▄          ░░▒▓██████████
█▓▒░                                ░▓███▓▓▓█████▀           ░▒▓██████████
▓▓▒░                     ▄     ░░▓█████▒██▓▓▓█░█             ░▒▓██████████
▓▒▒                       █████████▒▒▒▒▒░█▓▓▓█▀              ░▒▓██████████
▓▒░                        ██▓░░░░░░▒▒▒░░█▓▓██               ░▒▓██████████
▓▒▒                         ▀██░░░░░░▒░░░█▓▓█▌               ░▒▓▓█████████
▓▓▒                           ███░░░░░░░░░███                ░▒▒▓█████████
█▓▒░                           ▀██▒░░░░░░░░▒█                 ░▒▓█████████
█▓▒░                             ▀██▓░░░░░░░█▌                ░▒▓█████████
█▓▒░                               ▀██▓░░░░▒█▌                ░▒▓█████████
█▓▒░                                 ██▓▒░▒▓█▌                ░▒▓█████████
█▓▒░                                   ▀████▀                 ░▒▓▓████████
█▓▒▒░                                                          ▒▒▓████████
█▓▒▒░                                                          ░▒▓████████
█▓▓▒░                                                          ░▒▓████████
██▓▒░                                                          ░▒▓▓▓██████
██▓▒▒░                                                         ░▒▒▒▓██████
██▓▓▒▒                                                          ░░▒▓██████
██▓▓▓▒░                                                          ░▒▓██████
████▓▒░                                                          ░▒▓██████
████▓▒░                                                          ░▒▓▓█████
████▓▒░                                                          ░▒▒▓█████
████▓▒░                                                           ░▒▓▓▓███
████▓▒░                                                           ░▒▒▒▓███
████▓▒░                                                            ▒▒▒▓▓██</pre>
                </div>
            </div>
            <div class="input-box fixed">
                <div class="input-wrapper">
                    <div class="chat-input">
                        <div class="input-name">
                            <span class="name">Query</span>
                        </div>
                        <div class="input-controls">
                            <input id="query" type="text">
                        </div>
                        <div class="input-controls">
                            <input id="query-btn" type="submit" value="Submit">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<script>
    function request() {
        var q = $("#query").val();
        $("#query").val("");
        $(".scrollable")
                .find(".chat")
                .end()
                .append("<div class='chat chat-normal'>me> "+q+"</div>");
        $(window).scrollTop($(".scrollable").get(0).scrollHeight);

        $.post("http://localhost:8000/request", {query : q}, function (data) {
            $.each(data, function(key, value){
                value.forEach(function (obj) {
                    $(".scrollable")
                            .find(".chat")
                            .end()
                            .append("<div class='chat chat-normal'>HandsomeBot>" +
                            "<span class='timestamp'>["+ obj.date +"]</span> " +
                            "<span class='section'>["+ obj.section +"]</span> " +
                            "<span class='release'>["+ obj.releasename +"]</span> " +
                            "<span class='info'>["+ obj.nb_files + "f|" + obj.size +"mb]</span>" +
                            "</div>");
                    $(window).scrollTop($(".scrollable").get(0).scrollHeight);
                });
            });
        }, "json")
                .fail(function ($xhr) {
                    var data = $xhr.responseJSON;
                    $(".scrollable")
                            .find(".chat")
                            .end()
                            .append("<div class='chat chat-normal'>HandsomeBot> " +
                            "<span class='text'>"+ data.message +"</span>" +
                            "</div>");
                    $(window).scrollTop($(".scrollable").get(0).scrollHeight);
                });
    }

    $(document).ready(function() {
        $(window).scrollTop($(".scrollable").get(0).scrollHeight);
    });

    $(document).keypress(function(e) {
        if(e.which == 13) {
            request();
            return false;
        }
    });

    $("#query-btn").click(function() {
        request();
        return false;
    });
</script>
</html>
